---
import { Icon } from 'astro-icon/components';

import Button from '../common/Button.astro';
// import { sendEmail } from '../../utils/email';
// console.log(Astro.request);
// console.log('Astro.response');
// console.log(Astro.response);
// console.log(Astro.requeset.method);
// if (Astro.request.method === 'POST') {
//   try {
//     const data = await Astro.request.formData();
//     const name = data.get('username');
//     const email = data.get('email');
//     const password = data.get('password');
//     // Do something with the data
//   } catch (error) {
//     if (error instanceof Error) {
//       console.error(error.message);
//     }
//   }
// }

// console.log('Astro.request');
// console.log(Astro.request);

// if (Astro.request.method === 'POST') {
//   console.log('TWAS A POST');
//   // const data = await Astro.request.formData();
//   // const fullname = data.get('fullname') as string | null;
//   // const company = data.get('company') as string | null;
//   // const email = data.get('email') as string | null;
//   // const message = data.get('message') as string | null;

//   // try {
//   //   await sendEmail({
//   //     to: 'jamiesullivan523@gmail.com',
//   //     subject: `Inquiry from ${fullname} at ${company}`,
//   //     template: {
//   //       name: 'inquiry',
//   //       params: {
//   //         fullname,
//   //         company,
//   //         email,
//   //         message,
//   //       },
//   //     },
//   //   });
//   // } catch (error) {
//   //   throw new Error('Failed to send email');
//   // }
// }

// const cookies = Astro.cookies;
// cookies.delete('fullname');
// cookies.delete('company');
// cookies.delete('email');
// cookies.delete('message');
---

<section id='contact'>
  <div class='wrapper container'>
    <div class='left-section'>
      <div>
        <h2 class='lf-semibold'>Contact Us</h2>
        <div class='sans-regular'>
          <p>
            Leave your details and a short message and weâ€™ll get back to you
            within 24 hours
          </p>
          <div class='contact'>
            <div class='info'>
              <Icon
                name='material-symbols:phone-enabled'
                width={24}
                height={24}
              />
              <span>+353 859664876</span>
            </div>
            <div class='info'>
              <Icon
                name='material-symbols:mail-rounded'
                width={24}
                height={24}
              />
              <span>henrique@elevequity.com</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class='sans-regular'>
      <form
        id='contact-form'
        method='POST'
        action='/actions/send-email'
      >
        <div class='input'>
          <label for='fullname'>Full name</label>
          <input
            autocomplete='off'
            name='fullname'
            aria-label='fullname'
            value=''
            placeholder='Full name'
            type='text'
          />
          <p
            id='fullname-error'
            class='error'
          >
            Full name is required
          </p>
        </div>
        <div class='input'>
          <label for='company'>Company name</label>
          <input
            autocomplete='off'
            name='company'
            aria-label='company'
            value=''
            placeholder='Company name'
            type='text'
          />
          <p
            id='company-error'
            class='error'
          >
            Company name is required
          </p>
        </div>
        <div class='input'>
          <label for='email'>Email address</label>
          <input
            autocomplete='off'
            name='email'
            aria-label='email'
            value=''
            placeholder='Email address'
            type='text'
          />
          <p
            id='email-error'
            class='error'
          >
            Email is required
          </p>
        </div>
        <div class='input'>
          <label for='message'>Your message</label>
          <input
            autocomplete='off'
            name='message'
            aria-label='message'
            value=''
            placeholder='Your message'
            type='text'
          />
          <p
            id='message-error'
            class='error'
          >
            Message requires 10 characters
          </p>
        </div>
        <div class='btn-container'>
          <Button
            className='submit'
            text='Submit'
            type='submit'
          />
        </div>
      </form>
    </div>
  </div>
</section>

<style lang='scss'>
  @import '../../styles/variables.scss';

  section {
    background-color: $neutral-light;
    color: $dark;
  }

  .container {
    display: grid;
    grid-template-columns: 1fr;
  }

  .left-section {
    display: grid;

    p {
      max-width: 32rem;
      margin: 1rem 0;
    }

    .contact {
      display: flex;
      flex-wrap: wrap;
      margin-bottom: 1.5rem;

      div:first-child {
        margin-right: 1.5rem;
      }

      .info {
        display: flex;
        align-items: center;
        margin-bottom: 0.5rem;

        span {
          margin-left: 0.5rem;
        }
      }
    }
  }

  form {
    display: flex;
    flex-direction: column;
    gap: 2rem;

    .input {
      display: flex;
      flex-direction: column;

      label {
        display: none;
      }
    }

    textarea {
      min-height: 12.5rem;
    }

    .btn-container {
      width: 100%;
    }

    .error {
      display: none;
      margin-top: 0.5rem;
      color: rgb(187, 9, 9);
    }
  }

  // Above mobile
  @media only screen and (min-width: $mobile) {
    form {
      .btn-container {
        align-self: flex-end;
        width: max-content;
      }
    }
  }

  // Above tablet
  @media only screen and (min-width: $tablet) {
    .container {
      display: grid;
      grid-template-columns: 1fr 1fr;
    }

    .left-section {
      display: grid;

      p {
        max-width: 20rem;
        margin: 2rem 0;
      }

      .contact {
        display: flex;
        flex-direction: column;

        .info {
          display: flex;
          align-items: center;

          &:first-child {
            margin-bottom: 1rem;
          }

          span {
            margin-left: 0.75rem;
          }
        }
      }
    }
  }
</style>

<script>
  const form = document.getElementById('contact-form');

  form.addEventListener('submit', (e) => {
    e.preventDefault();

    const inputs = document.querySelectorAll('input');

    inputs.forEach((input: HTMLInputElement) => {
      const error = document.getElementById(`${input.name}-error`);

      if (input.name === 'fullname' || input.name === 'company') {
        validateText(input, 1);
      }

      if (input.name === 'message') {
        validateText(input, 9);
      }

      if (input.name === 'email') {
        const isValid = validateEmail(input.value);
        if (!input.value || input.value.length < 1) {
          error.style.display = 'block';
        } else if (!isValid) {
          error.style.display = 'block';
          error.innerHTML = 'Email is invalid';
        } else {
          error.style.display = 'none';
        }
      }
    });
  });

  const validateText = (input: HTMLInputElement, length: number) => {
    const error = document.getElementById(`${input.name}-error`);
    if (!input.value || input.value.length <= length) {
      error.style.display = 'block';
    } else {
      error.style.display = 'none';
    }
  };

  const validateEmail = (email: string) => {
    return email.match(
      /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/
    );
  };
</script>
